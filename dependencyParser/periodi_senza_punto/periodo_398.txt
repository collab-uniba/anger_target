The code in this class is  quite ugly at the moment        
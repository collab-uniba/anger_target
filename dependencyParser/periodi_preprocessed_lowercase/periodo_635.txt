this is really ugly because it requires to copy the whole code and make some additions      
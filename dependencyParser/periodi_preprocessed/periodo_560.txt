Ugly stuff  but itll do  for the moment     
* Some of the code is pretty ugly and there are no test cases defined.      
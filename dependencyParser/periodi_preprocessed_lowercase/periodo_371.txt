i agree the #ifdefs are ugly and i wish they could be avoided      